<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <!-- Cabeçalho omitido para brevidade -->
</head>

<body>
    <div class="container">
        <!-- Conteúdo omitido para brevidade -->

        <section class="posts">
            <h3>Denúncias</h3>
            <div id="lista-denuncias">
                <!-- As postagens serão geradas aqui -->
            </div>
        </section>

        <script>
            document.addEventListener('DOMContentLoaded', () => {
                fetch('http://localhost:3000/api/denuncia')
                    .then(response => response.json())
                    .then(denuncias => {
                        const listaDoFront = document.getElementById('lista-denuncias');
                        listaDoFront.innerHTML = '';

                        denuncias.forEach((denuncia, i) => {
                            const postDenuncia = document.createElement('div');
                            postDenuncia.className = 'post1';
                            postDenuncia.innerHTML = `
                                <div class="post-header">
                                    <img src="imagens/close-up-confident-male-employee-white-collar-shirt-smiling-camera-standing-self-assured-against-studio-background.jpg" alt="${denuncia.autor}" class="small-img">
                                    <h1>${denuncia.autor}</h1>
                                </div>
                                <h2>${denuncia.localizacao}</h2>
                                <p>${denuncia.descricao}</p>
                                <div class="likes">
                                    <p><b>Likes:</b> <span id="contador-likes-${i}">${denuncia.likes}</span></p>
                                    <svg class="like" onclick="curtir(${denuncia.id}, ${i})" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-suit-heart-fill" viewBox="0 0 16 16">
                                        <path d="M4 1c2.21 0 4 1.755 4 3.92C8 2.755 9.79 1 12 1s4 1.755 4 3.92c0 3.263-3.234 4.414-7.608 9.608a.513.513 0 0 1-.784 0C3.234 9.334 0 8.183 0 4.92 0 2.755 1.79 1 4 1" />
                                    </svg>
                                </div>
                            `;
                            listaDoFront.appendChild(postDenuncia);
                        });
                    })
                    .catch(error => console.error('Erro ao buscar denúncias:', error));
            });

            function curtir(id, index) {
                fetch(`http://localhost:3000/api/denuncia/${id}/like`, {
                    method: 'PATCH'
                })
                .then(response => response.json())
                .then(denunciaAtualizada => {
                    const contador = document.getElementById(`contador-likes-${index}`);
                    contador.innerText = denunciaAtualizada.likes;
                })
                .catch(error => console.error('Erro ao curtir:', error));
            }
        </script>
    </div>
</body>


<script>
const express = require('express');
const cors = require('cors');
const app = express();

app.use(cors());
app.use(express.json());

let denuncias = []; // Banco de dados em memória para exemplo

// Endpoint para obter todas as denúncias
app.get('/api/denuncia', (req, res) => {
    res.json(denuncias);
});

// Endpoint para criar uma nova denúncia
app.post('/api/denuncia', (req, res) => {
    const { descricao, autor, localizacao } = req.body;
    const id = denuncias.length + 1;
    const novaDenuncia = { id, descricao, autor, localizacao, likes: 0 };
    denuncias.push(novaDenuncia);
    res.status(201).json(novaDenuncia);
});

// Endpoint para atualizar os likes de uma denúncia
app.patch('/api/denuncia/:id/like', (req, res) => {
    const { id } = req.params;
    const denuncia = denuncias.find(d => d.id === parseInt(id));
    if (denuncia) {
        denuncia.likes += 1;
        res.json(denuncia);
    } else {
        res.status(404).json({ mensagem: 'Denúncia não encontrada.' });
    }
});

// Iniciar o servidor
const PORT = 3000;
app.listen(PORT, () => {
    console.log(`Servidor rodando na porta ${PORT}`);
});
</script>
</html>