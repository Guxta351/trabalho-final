<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ecosanea - Denúncias</title>
    <link rel="stylesheet" href="style.css">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
</head>
<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: "Ubuntu", sans-serif;
}

body {
    display: flex;
    min-height: 100vh;
    background-color: #85c4f8;
    position: relative;
}

/* Menu Lateral */
nav.menu-lateral {
    width: 80px;
    height: 100%;
    background-color: #fff;
    padding: 40px 0 40px 1%;
    box-shadow: 3px 0 0 rgb(137, 203, 247);
    position: fixed;
    top: 0;
    left: 0;
    overflow: hidden;
    transition: width 0.2s;
}

nav.menu-lateral:hover {
    width: 300px;
}

.btn-expandir {
    width: 100%;
    padding-left: 10px;
}

.btn-expandir > i {
    color: rgb(128, 197, 243);
    font-size: 24px;
    cursor: pointer;
}

ul {
    height: 100%;
    list-style: none;
    padding: 0;
    margin: 0;
}

ul li.item-menu {
    transition: background-color 0.2s;
}

ul li.item-menu:hover {
    background-color: #6dc7e2;
    border-radius: 8px;
}

ul li.item-menu a {
    color: rgb(12, 12, 12);
    text-decoration: none;
    font-size: 20px;
    padding: 20px 4%;
    display: flex;
    align-items: center;
    margin-bottom: 20px;
    line-height: 30px;
}

ul li.item-menu a .txt-link {
    margin-left: 40px;
}

ul li.item-menu a .icon > i {
    font-size: 30px;
    margin-left: 10px;
}

/* Header */
header {
    width: calc(100% - 80px);
    padding: 20px;
    margin-left: 80px;
    display: flex;
    justify-content: center;
    position: fixed;
    top: 0;
    background-color: #85c4f8;
    z-index: 1;
    transition: margin-left 0.2s, width 0.2s;
}

nav.menu-lateral:hover + header {
    margin-left: 300px;
    width: calc(100% - 300px);
}


.pesquisa {
    display: flex;
    align-items: center;
    background: #fff;
    border-radius: 8px;
    padding: 5px 10px;
    width: 55%;
    max-width: 600px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.pesquisa input {
    border: none;
    outline: none;
    flex: 1;
    padding: 10px;
    font-size: 16px;
}

.pesquisa button {
    background: none;
    border: none;
    cursor: pointer;
    padding: 0 10px;
    color: #333;
}

.pesquisa button:hover {
    color: #6dc7e2;
}

/* Main Content */
main {
    flex: 1;
    padding: 100px 20px 20px 20px; /* Ajuste para não ficar atrás do header */
    margin-left: 80px;
    transition: margin-left 0.3s;
}

nav.menu-lateral.expandir ~ main {
    margin-left: 250px;
}

.lista-denuncias {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

/* Cartão de Denúncia */
.cartao {
    width: 40%;
            border: 2px solid black;
            border-radius: 15px;
            padding: 3%;
            margin-left: 30%;
            background-color: rgb(255, 255, 255);
            margin-bottom: 20px;
}

.cartao .descricao {
    font-size: 18px;
    margin-bottom: 10px;
}

.cartao .localizacao {
    font-size: 14px;
    color: #555;
}

.cartao .rodape {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 15px;
}

.cartao .coracao {
    cursor: pointer;
    color: #333;
    transition: color 0.3s;
}

.cartao .coracao.ativo {
    color: red;
}

/* Logo */
.logo {
    position: fixed;
    bottom: 20px;
    right: 20px;
    width: 80px;
    cursor: pointer;
    transition: transform 0.3s;
}

.logo:hover {
    transform: scale(1.1);
}

/* Responsividade */
@media (max-width: 768px) {
    nav.menu-lateral {
        width: 60px;
    }

    nav.menu-lateral.expandir {
        width: 200px;
    }

    header {
        padding: 10px;
    }

    .pesquisa {
        width: 80%;
    }

    .logo {
        width: 60px;
    }
}
</style>
<body>
    <nav class="menu-lateral">
        <div class="btn-expandir">
            <i class="bi bi-list" id="btn-exp"></i>
        </div>
        <ul>
            <li class="item-menu">
                <a href="perfil.html">
                    <i class="bi bi-calendar"></i>
                    <span class="txt-link">Conta</span>
                </a>
            </li>
            <li class="item-menu">
                <a href="entrar.html">
                    <i class="bi bi-person"></i>
                    <span class="txt-link">Login</span>
                </a>
            </li>
        </ul>
    </nav>

    <header>
        <div class="pesquisa">
            <input type="text" id="pesquisa-input" placeholder="Qual sua denúncia?">
            <button id="lupa">
                <i class="bi bi-search"></i>
            </button>
        </div>
    </header>

    <main>
        <div class="lista-denuncias" id="lista-denuncias">
            <!-- Denúncias serão inseridas aqui via JavaScript -->
        </div>
    </main>

    <!-- Imagem de Logo -->
    <img src="imagens/EcoSanea-removebg-preview.png" alt="Ecosanea Logo" class="logo">

    <!-- Scripts -->
    <script src="app.js"></script>
</body>
<script>
document.addEventListener('DOMContentLoaded', () => {
    const btnExp = document.getElementById('btn-exp');
    const menuSide = document.querySelector('.menu-lateral');
    const listaDenuncias = document.getElementById('lista-denuncias');
    const inputPesquisa = document.getElementById('pesquisa-input');
    const btnLupa = document.getElementById('lupa');

    // Toggle do menu lateral
    btnExp.addEventListener('click', () => {
        menuSide.classList.toggle('expandir');
    });

    // Função para carregar denúncias do backend
    const carregarDenuncias = async () => {
        try {
            const response = await fetch('http://localhost:3000/denuncia');
            if (!response.ok) throw new Error('Erro ao carregar denúncias');
            const denuncias = await response.json();
            listaDenuncias.innerHTML = ''; // Limpa denúncias existentes
            denuncias.forEach(criarCartaoDenuncia);
        } catch (error) {
            console.error(error);
            alert('Não foi possível carregar as denúncias.');
        }
    };

    // Função para criar um cartão de denúncia
    const criarCartaoDenuncia = (denuncia) => {
        const cartao = document.createElement('div');
        cartao.classList.add('cartao');

        cartao.innerHTML = `
            <p class="descricao">${denuncia.descricao}</p>
            <small class="localizacao">Localização: ${denuncia.localizacao}</small>
            <div class="rodape">
                <div class="coracao" data-id="${denuncia.id}">
                    <i class="bi bi-suit-heart-fill"></i>
                </div>
            </div>
        `;

        // Evento de like
        const coracao = cartao.querySelector('.coracao');
        coracao.addEventListener('click', () => toggleLike(denuncia.id, coracao));

        listaDenuncias.appendChild(cartao);
    };

    // Função para enviar nova denúncia
    const enviarDenuncia = async () => {
        const descricao = inputPesquisa.value.trim();
        if (!descricao) {
            alert('Por favor, insira uma descrição para a denúncia.');
            return;
        }

        // Obter dados do usuário autenticado (exemplo estático)
        const autor = {
            id_usuario: 1, // Este valor deve vir da autenticação real
            endereco: 'Endereço Exemplo' // Este valor deve vir da autenticação real
        };

        const novaDenuncia = {
            descricao,
            autor: autor.id_usuario,
            localizacao: autor.endereco
        };

        try {
            const response = await fetch('http://localhost:3000/denuncia', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(novaDenuncia)
            });

            if (!response.ok) throw new Error('Falha ao enviar denúncia.');

            alert('Denúncia enviada com sucesso!');
            inputPesquisa.value = '';
            carregarDenuncias();
        } catch (error) {
            console.error(error);
            alert('Não foi possível enviar a denúncia.');
        }
    };

    // Função para alternar like
    const toggleLike = async (id, elemento) => {
        try {
            // Aqui você pode implementar a lógica para enviar o like para o backend
            // Exemplo: PATCH ou POST para atualizar o like
            // Por enquanto, apenas alterna a classe 'ativo'
            elemento.classList.toggle('ativo');
        } catch (error) {
            console.error(error);
            alert('Não foi possível registrar o like.');
        }
    };

    // Evento de clique no botão de busca/lupa
    btnLupa.addEventListener('click', enviarDenuncia);

    // Carregar denúncias ao iniciar
    carregarDenuncias();
});
</script>
<script>
const express = require('express');
const cors = require('cors');
const app = express();

app.use(cors());
app.use(express.json());

let denuncias = []; // Banco de dados em memória para exemplo

app.get('/denuncia', (req, res) => {
    res.json(denuncias);
});

app.post('/denuncia', (req, res) => {
    const { descricao, autor, localizacao } = req.body;
    const id = denuncias.length + 1;
    const novaDenuncia = { id, descricao, autor, localizacao };
    denuncias.push(novaDenuncia);
    res.status(201).json(novaDenuncia);
});

// Iniciar o servidor
app.listen(3000, () => {
    console.log('Servidor rodando na porta 3000');
});
</script>

</html>
